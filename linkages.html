<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linkages & Shock Analysis - USEEIO v2.0.1</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'IBM Plex Sans', -apple-system, sans-serif;
            background: #fff;
            color: #1a1a1a;
            min-height: 100vh;
            line-height: 1.5;
        }

        .app-header {
            background: #fff;
            border-bottom: 1px solid #e5e5e5;
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .app-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1a1a1a;
        }

        .app-subtitle {
            font-size: 0.75rem;
            color: #666;
            margin-top: 2px;
        }

        .nav-tabs {
            display: flex;
            gap: 4px;
        }

        .nav-tab {
            padding: 8px 16px;
            font-size: 0.85rem;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.15s;
            border-bottom: 2px solid transparent;
        }

        .nav-tab:hover { color: #1a1a1a; }
        .nav-tab.active { 
            color: #1a1a1a; 
            border-bottom-color: #1a1a1a;
        }

        .main-container {
            padding: 32px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .page { display: none; }
        .page.active { display: block; }

        /* =============== LINKAGES PAGE STYLES =============== */
        .page-intro {
            max-width: 720px;
            margin-bottom: 32px;
        }

        .page-intro h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .page-intro p {
            font-size: 0.9rem;
            color: #444;
            margin-bottom: 12px;
        }

        .linkages-grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 32px;
        }

        .chart-card {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
            padding: 24px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: #1a1a1a;
        }

        .chart-subtitle {
            font-size: 0.75rem;
            color: #666;
            margin-top: 4px;
        }

        .clear-selection {
            font-size: 0.75rem;
            color: #666;
            cursor: pointer;
            padding: 4px 8px;
            border: 1px solid #e5e5e5;
            border-radius: 3px;
            background: #fafafa;
            display: none;
        }

        .clear-selection:hover { background: #f0f0f0; }
        .clear-selection.visible { display: block; }

        #quadrant-chart {
            width: 100%;
            height: 480px;
        }

        .quadrant-legend {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e5e5e5;
        }

        .quadrant-item {
            display: flex;
            gap: 12px;
        }

        .quadrant-dot {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            flex-shrink: 0;
            margin-top: 3px;
        }

        .quadrant-dot.key { background: #16a34a; }
        .quadrant-dot.forward { background: #ea580c; }
        .quadrant-dot.backward { background: #2563eb; }
        .quadrant-dot.weak { background: #9ca3af; }

        .quadrant-text h4 {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .quadrant-text p {
            font-size: 0.7rem;
            color: #666;
            line-height: 1.4;
        }

        .sidebar-card {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
            padding: 20px;
            height: fit-content;
        }

        .sidebar-title {
            font-size: 0.8rem;
            font-weight: 700;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #1a1a1a;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .stat-row:last-of-type { border-bottom: none; }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
        }

        .stat-value {
            font-size: 1rem;
            font-weight: 600;
            font-family: 'IBM Plex Mono', monospace;
        }

        .industry-search {
            width: 100%;
            background: #fafafa;
            border: 1px solid #e5e5e5;
            color: #1a1a1a;
            padding: 10px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-family: inherit;
            outline: none;
            margin: 16px 0 12px;
        }

        .industry-search:focus { border-color: #1a1a1a; }

        .industry-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .industry-item {
            padding: 10px 12px;
            border-radius: 3px;
            margin-bottom: 4px;
            cursor: pointer;
            transition: all 0.1s;
            border-left: 3px solid transparent;
            background: #fafafa;
        }

        .industry-item:hover { background: #f0f0f0; }
        .industry-item.selected { background: #e5e5e5; border-left-color: #1a1a1a; }
        .industry-item.key-sector { border-left-color: #16a34a; }
        .industry-item.forward-oriented { border-left-color: #ea580c; }
        .industry-item.backward-oriented { border-left-color: #2563eb; }

        .industry-name {
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .industry-metrics {
            display: flex;
            gap: 12px;
            font-size: 0.7rem;
            color: #666;
            font-family: 'IBM Plex Mono', monospace;
        }

        /* =============== EXPLANATION SECTION =============== */
        .explanation-section {
            margin-top: 40px;
            padding-top: 32px;
            border-top: 1px solid #e5e5e5;
        }

        .explanation-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .explanation-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }

        .explanation-card {
            padding: 20px;
            background: #fafafa;
            border-radius: 4px;
        }

        .explanation-card h4 {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .explanation-card p {
            font-size: 0.8rem;
            color: #444;
            line-height: 1.6;
        }

        .explanation-card ul {
            margin: 12px 0 0 16px;
            font-size: 0.8rem;
            color: #444;
        }

        .explanation-card li {
            margin-bottom: 6px;
        }

        /* =============== SHOCK ANALYSIS PAGE STYLES =============== */
        .shock-container {
            display: flex;
            gap: 32px;
        }

        .shock-sidebar {
            width: 300px;
            flex-shrink: 0;
        }

        .shock-card {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
            overflow: hidden;
        }

        .shock-card-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e5e5e5;
        }

        .shock-card-title {
            font-size: 0.85rem;
            font-weight: 700;
        }

        .shock-card-subtitle {
            font-size: 0.7rem;
            color: #666;
            margin-top: 2px;
        }

        .shock-tabs {
            display: flex;
            border-bottom: 1px solid #e5e5e5;
        }

        .shock-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            font-size: 0.75rem;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.15s;
        }

        .shock-tab:hover { color: #1a1a1a; }
        .shock-tab.active { color: #1a1a1a; border-bottom-color: #1a1a1a; }

        .shock-content {
            padding: 16px;
            max-height: calc(100vh - 280px);
            overflow-y: auto;
        }

        .shock-panel { display: none; }
        .shock-panel.active { display: block; }

        .section-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 16px 0 8px;
        }

        .section-label:first-child { margin-top: 0; }

        .search-input {
            width: 100%;
            background: #fafafa;
            border: 1px solid #e5e5e5;
            color: #1a1a1a;
            padding: 8px 10px;
            border-radius: 3px;
            font-size: 0.8rem;
            font-family: inherit;
            outline: none;
            margin-bottom: 8px;
        }

        .search-input:focus { border-color: #1a1a1a; }

        .shock-industry-list {
            max-height: 160px;
            overflow-y: auto;
            margin-bottom: 12px;
        }

        .shock-industry-item {
            padding: 8px 10px;
            border-radius: 3px;
            margin-bottom: 3px;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.1s;
            border: 1px solid transparent;
        }

        .shock-industry-item:hover { background: #f0f0f0; }
        .shock-industry-item.selected { border-color: #1a1a1a; background: #f0f0f0; }

        .shock-industry-name {
            font-size: 0.75rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .shock-industry-meta {
            font-size: 0.65rem;
            color: #888;
            margin-top: 2px;
        }

        .slider-group {
            margin-bottom: 12px;
        }

        .slider-label {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
        }

        .slider-value {
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 600;
            color: #1a1a1a;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            background: #e5e5e5;
            border-radius: 2px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #1a1a1a;
            border-radius: 50%;
            cursor: pointer;
        }

        .btn {
            width: 100%;
            background: #1a1a1a;
            border: none;
            color: #fff;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            margin-top: 8px;
        }

        .btn:hover { background: #333; }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .btn-outline {
            background: #fff;
            color: #666;
            border: 1px solid #e5e5e5;
        }

        .btn-outline:hover { background: #fafafa; }

        .results-panel {
            flex: 1;
            min-width: 0;
        }

        .results-header {
            margin-bottom: 24px;
        }

        .results-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .results-subtitle {
            font-size: 0.8rem;
            color: #666;
        }

        .metrics-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-card {
            background: #fafafa;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
            padding: 16px;
        }

        .metric-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 6px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
        }

        .metric-value.positive { color: #16a34a; }
        .metric-value.negative { color: #dc2626; }

        .metric-detail {
            font-size: 0.7rem;
            color: #888;
            margin-top: 4px;
        }

        .results-card {
            background: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .results-card-title {
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .results-card-subtitle {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 16px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 8px 10px;
            font-size: 0.65rem;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            border-bottom: 1px solid #e5e5e5;
        }

        .data-table td {
            padding: 8px 10px;
            font-size: 0.8rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tr:hover { background: #fafafa; }

        .bar-cell {
            height: 4px;
            background: #e5e5e5;
            border-radius: 2px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s;
        }

        .bar-fill.blue { background: #2563eb; }
        .bar-fill.red { background: #dc2626; }
        .bar-fill.orange { background: #ea580c; }

        .risk-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 2px;
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-badge.high { background: #fef2f2; color: #dc2626; }
        .risk-badge.medium { background: #fff7ed; color: #ea580c; }
        .risk-badge.low { background: #f0fdf4; color: #16a34a; }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-state-text {
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .empty-state-hint {
            font-size: 0.75rem;
            color: #aaa;
        }

        .tooltip {
            position: fixed;
            pointer-events: none;
            background: #fff;
            border: 1px solid #e5e5e5;
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 0.8rem;
            max-width: 300px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.1s;
        }

        .tooltip.visible { opacity: 1; }
        .tooltip-title { font-weight: 600; margin-bottom: 8px; }
        .tooltip-row { display: flex; justify-content: space-between; gap: 16px; margin-bottom: 3px; }
        .tooltip-label { color: #666; }
        .tooltip-value { font-family: 'IBM Plex Mono', monospace; font-weight: 500; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e5e5e5; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #d0d0d0; }

        @media (max-width: 1100px) {
            .linkages-grid { grid-template-columns: 1fr; }
            .shock-container { flex-direction: column; }
            .shock-sidebar { width: 100%; }
            .metrics-row { grid-template-columns: repeat(2, 1fr); }
            .explanation-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div>
            <div class="app-title">Economic Linkage Analysis</div>
            <div class="app-subtitle">USEEIO v2.0.1 · 411 Industries</div>
        </div>
        <nav class="nav-tabs">
            <div class="nav-tab active" data-page="linkages">Linkages</div>
            <div class="nav-tab" data-page="shock">Shock Analysis</div>
        </nav>
    </header>

    <main class="main-container">
        <!-- =============== LINKAGES PAGE =============== -->
        <div class="page active" id="page-linkages">
            <div class="page-intro">
                <h2>How Industries Connect</h2>
                <p>This chart shows how each of the 411 US industries relates to the rest of the economy. Industries that buy a lot from others (high <strong>backward linkage</strong>) appear further right. Industries that sell a lot to others (high <strong>forward linkage</strong>) appear higher up. Click any industry in the list to highlight it on the chart.</p>
            </div>

            <div class="linkages-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Forward vs Backward Linkages</div>
                            <div class="chart-subtitle">Each dot is an industry. Size = annual output. Position = economic role.</div>
                        </div>
                        <button class="clear-selection" id="clear-selection" onclick="clearSelection()">Clear selection</button>
                    </div>
                    <div id="quadrant-chart"></div>
                    
                    <div class="quadrant-legend">
                        <div class="quadrant-item">
                            <div class="quadrant-dot key"></div>
                            <div class="quadrant-text">
                                <h4>Key Sectors</h4>
                                <p>Buy heavily from suppliers AND sell heavily to customers. Most interconnected industries (e.g., Steel, Chemicals).</p>
                            </div>
                        </div>
                        <div class="quadrant-item">
                            <div class="quadrant-dot forward"></div>
                            <div class="quadrant-text">
                                <h4>Forward Oriented</h4>
                                <p>Sell to many industries but don't buy much. Supply chain "sources" (e.g., Mining, Utilities, Wholesale).</p>
                            </div>
                        </div>
                        <div class="quadrant-item">
                            <div class="quadrant-dot backward"></div>
                            <div class="quadrant-text">
                                <h4>Backward Oriented</h4>
                                <p>Buy from many suppliers but fewer sell to. Demand drivers (e.g., Construction, Automobiles).</p>
                            </div>
                        </div>
                        <div class="quadrant-item">
                            <div class="quadrant-dot weak"></div>
                            <div class="quadrant-text">
                                <h4>Weak Linkages</h4>
                                <p>Relatively independent. Often service industries with limited inter-industry trade (e.g., Education, Personal services).</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-card">
                    <div class="sidebar-title">Summary</div>
                    <div class="stat-row">
                        <span class="stat-label">Total industries</span>
                        <span class="stat-value" id="stat-total">411</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Key sectors</span>
                        <span class="stat-value" id="stat-key">—</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Avg backward linkage</span>
                        <span class="stat-value" id="stat-bl">1.00</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Avg forward linkage</span>
                        <span class="stat-value" id="stat-fl">1.00</span>
                    </div>

                    <input type="text" class="industry-search" id="linkage-search" placeholder="Search industries...">
                    
                    <div class="industry-list" id="industry-list"></div>
                </div>
            </div>

            <div class="explanation-section">
                <div class="explanation-title">Understanding Linkages</div>
                <div class="explanation-grid">
                    <div class="explanation-card">
                        <h4>What is a Backward Linkage?</h4>
                        <p>Backward linkage measures how much an industry <strong>buys from other industries</strong> to produce its output. Think of it as "demand pull" — when this industry grows, it pulls demand from its suppliers.</p>
                        <ul>
                            <li><strong>High BL (>1):</strong> The industry relies heavily on inputs from many sectors. Growth here stimulates broad supplier activity.</li>
                            <li><strong>Low BL (<1):</strong> The industry is more self-contained or uses fewer intermediate inputs.</li>
                        </ul>
                        <p style="margin-top:12px"><strong>Example:</strong> Automobile manufacturing has high backward linkage because it buys steel, glass, electronics, plastics, and textiles from many industries.</p>
                    </div>
                    <div class="explanation-card">
                        <h4>What is a Forward Linkage?</h4>
                        <p>Forward linkage measures how much an industry <strong>sells to other industries</strong> as inputs to their production. Think of it as "supply push" — this industry enables others to operate.</p>
                        <ul>
                            <li><strong>High FL (>1):</strong> Many industries depend on this sector's output. Disruptions here ripple widely.</li>
                            <li><strong>Low FL (<1):</strong> Output mainly goes to final consumers rather than other businesses.</li>
                        </ul>
                        <p style="margin-top:12px"><strong>Example:</strong> Electricity generation has high forward linkage because nearly every industry needs power to operate.</p>
                    </div>
                    <div class="explanation-card">
                        <h4>What does "Key Sector" mean?</h4>
                        <p>A <strong>key sector</strong> has both high backward AND high forward linkages (both above 1.0). These industries are the most interconnected in the economy.</p>
                        <p style="margin-top:8px">Key sectors are strategically important because:</p>
                        <ul>
                            <li>They create multiplier effects in both directions</li>
                            <li>Investment here has maximum economic ripple effect</li>
                            <li>Disruptions to key sectors impact the entire supply chain</li>
                        </ul>
                        <p style="margin-top:12px"><strong>Examples:</strong> Iron and steel, Basic chemicals, Petroleum refining, Plastics.</p>
                    </div>
                    <div class="explanation-card">
                        <h4>How to read the values</h4>
                        <p>Linkage values are <strong>normalized</strong> so that 1.0 represents the economy-wide average.</p>
                        <ul>
                            <li><strong>BL = 1.5</strong> means 50% more backward linkage than average</li>
                            <li><strong>FL = 0.8</strong> means 20% less forward linkage than average</li>
                            <li><strong>BL = 2.0</strong> means double the average input purchases</li>
                        </ul>
                        <p style="margin-top:12px">The size of each dot represents the industry's annual output in billions of dollars — larger industries have bigger economic footprints.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- =============== SHOCK ANALYSIS PAGE =============== -->
        <div class="page" id="page-shock">
            <div class="page-intro">
                <h2>Economic Shock Simulator</h2>
                <p>Explore what happens when demand changes or costs increase in a specific industry. See how effects propagate through supply chains using input-output relationships.</p>
            </div>

            <div class="shock-container">
                <div class="shock-sidebar">
                    <div class="shock-card">
                        <div class="shock-card-header">
                            <div class="shock-card-title">Analysis Settings</div>
                            <div class="shock-card-subtitle">Select an industry and shock type</div>
                        </div>
                        
                        <div class="shock-tabs">
                            <div class="shock-tab active" data-tab="demand">Demand</div>
                            <div class="shock-tab" data-tab="cost">Cost</div>
                            <div class="shock-tab" data-tab="risk">Risk</div>
                        </div>

                        <div class="shock-content">
                            <!-- Demand Shock Panel -->
                            <div class="shock-panel active" id="panel-demand">
                                <div class="section-label">Industry</div>
                                <input type="text" class="search-input" id="search-demand" placeholder="Search...">
                                <div class="shock-industry-list" id="list-demand"></div>

                                <div class="section-label">Demand change</div>
                                <div class="slider-group">
                                    <div class="slider-label">
                                        <span>Final demand</span>
                                        <span class="slider-value" id="demand-value">+$1B</span>
                                    </div>
                                    <input type="range" id="demand-slider" min="-10" max="10" step="0.5" value="1">
                                </div>

                                <button class="btn" id="run-demand" disabled>Calculate impact</button>
                                <button class="btn btn-outline" id="clear-demand">Clear</button>
                            </div>

                            <!-- Cost Shock Panel -->
                            <div class="shock-panel" id="panel-cost">
                                <div class="section-label">Industry (cost source)</div>
                                <input type="text" class="search-input" id="search-cost" placeholder="Search...">
                                <div class="shock-industry-list" id="list-cost"></div>

                                <div class="section-label">Price increase</div>
                                <div class="slider-group">
                                    <div class="slider-label">
                                        <span>Cost change</span>
                                        <span class="slider-value" id="cost-value">+10%</span>
                                    </div>
                                    <input type="range" id="cost-slider" min="1" max="50" step="1" value="10">
                                </div>

                                <button class="btn" id="run-cost" disabled>Analyze propagation</button>
                                <button class="btn btn-outline" id="clear-cost">Clear</button>
                            </div>

                            <!-- Risk Analysis Panel -->
                            <div class="shock-panel" id="panel-risk">
                                <div class="section-label">About this analysis</div>
                                <p style="font-size: 0.75rem; color: #666; margin-bottom: 16px; line-height: 1.5;">
                                    Identifies industries most vulnerable to supply chain disruptions based on input concentration and pricing power.
                                </p>

                                <div class="section-label">Show risk levels</div>
                                <div class="slider-group">
                                    <div class="slider-label">
                                        <span>Threshold</span>
                                        <span class="slider-value" id="risk-threshold-value">Medium+</span>
                                    </div>
                                    <input type="range" id="risk-threshold" min="1" max="3" step="1" value="2">
                                </div>

                                <button class="btn" id="run-risk">Run analysis</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="results-panel">
                    <div class="results-header">
                        <div class="results-title" id="results-title">Results</div>
                        <div class="results-subtitle" id="results-subtitle">Select an industry and run analysis</div>
                    </div>
                    <div id="results-container">
                        <div class="empty-state">
                            <div class="empty-state-text">No analysis running</div>
                            <div class="empty-state-hint">Choose settings in the left panel and click a button to start</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // Data
        let linkagesData = [];
        let shockData = [];
        let L_sparse = {};
        let A_sparse = {};
        let selectedDemandIndustry = null;
        let selectedCostIndustry = null;
        let selectedChartIndustry = null;
        let chartElements = null;

        // Load data
        Promise.all([
            fetch('linkages_data.json').then(r => r.json()),
            fetch('shock_data.json').then(r => r.json())
        ]).then(([linkages, shock]) => {
            linkagesData = linkages.industries;
            
            const linkagesMap = {};
            linkagesData.forEach(d => linkagesMap[d.id] = d);
            
            shockData = shock.industries.map(d => ({
                ...d,
                bl: linkagesMap[d.id]?.bl || 1,
                fl: linkagesMap[d.id]?.fl || 1,
                isKey: linkagesMap[d.id]?.isKey || false
            }));
            
            L_sparse = shock.L_sparse || {};
            A_sparse = shock.A_sparse || {};
            
            initLinkagesPage();
            initShockPage();
            updateStats();
        });

        // Navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(`page-${tab.dataset.page}`).classList.add('active');
            });
        });

        // =============== LINKAGES PAGE ===============
        function initLinkagesPage() {
            createQuadrantChart();
            renderIndustryList();
            
            document.getElementById('linkage-search').addEventListener('input', (e) => {
                renderIndustryList(e.target.value);
            });
        }

        function updateStats() {
            const keySectors = linkagesData.filter(d => d.isKey).length;
            const avgBL = linkagesData.reduce((s, d) => s + d.bl, 0) / linkagesData.length;
            const avgFL = linkagesData.reduce((s, d) => s + d.fl, 0) / linkagesData.length;
            
            document.getElementById('stat-total').textContent = linkagesData.length;
            document.getElementById('stat-key').textContent = keySectors;
            document.getElementById('stat-bl').textContent = avgBL.toFixed(2);
            document.getElementById('stat-fl').textContent = avgFL.toFixed(2);
        }

        function getColor(d) {
            if (d.bl > 1 && d.fl > 1) return '#16a34a';
            if (d.fl > 1) return '#ea580c';
            if (d.bl > 1) return '#2563eb';
            return '#9ca3af';
        }

        function createQuadrantChart() {
            const container = document.getElementById('quadrant-chart');
            const width = container.clientWidth;
            const height = 480;
            const margin = { top: 30, right: 30, bottom: 50, left: 60 };

            const svg = d3.select('#quadrant-chart')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            const xExtent = d3.extent(linkagesData, d => d.bl);
            const yExtent = d3.extent(linkagesData, d => d.fl);
            const padding = 0.1;

            const xScale = d3.scaleLinear()
                .domain([Math.min(xExtent[0], 0.5) - padding, Math.max(xExtent[1], 2) + padding])
                .range([margin.left, width - margin.right]);

            const yScale = d3.scaleLinear()
                .domain([Math.min(yExtent[0], 0.5) - padding, Math.max(yExtent[1], 3) + padding])
                .range([height - margin.bottom, margin.top]);

            const sizeScale = d3.scaleSqrt()
                .domain([0, d3.max(linkagesData, d => d.output)])
                .range([3, 18]);

            // Reference lines at 1
            svg.append('line')
                .attr('x1', xScale(1)).attr('x2', xScale(1))
                .attr('y1', margin.top).attr('y2', height - margin.bottom)
                .attr('stroke', '#e5e5e5').attr('stroke-width', 1);

            svg.append('line')
                .attr('x1', margin.left).attr('x2', width - margin.right)
                .attr('y1', yScale(1)).attr('y2', yScale(1))
                .attr('stroke', '#e5e5e5').attr('stroke-width', 1);

            // Quadrant labels
            svg.append('text').attr('x', xScale(1.5)).attr('y', yScale(2.2)).attr('text-anchor', 'middle')
                .attr('fill', '#16a34a').attr('font-size', '0.65rem').attr('font-weight', '600').text('KEY');
            svg.append('text').attr('x', xScale(0.7)).attr('y', yScale(2.2)).attr('text-anchor', 'middle')
                .attr('fill', '#ea580c').attr('font-size', '0.65rem').attr('font-weight', '600').text('FORWARD');
            svg.append('text').attr('x', xScale(1.5)).attr('y', yScale(0.7)).attr('text-anchor', 'middle')
                .attr('fill', '#2563eb').attr('font-size', '0.65rem').attr('font-weight', '600').text('BACKWARD');
            svg.append('text').attr('x', xScale(0.7)).attr('y', yScale(0.7)).attr('text-anchor', 'middle')
                .attr('fill', '#9ca3af').attr('font-size', '0.65rem').attr('font-weight', '600').text('WEAK');

            // Axes
            svg.append('g')
                .attr('transform', `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(xScale).ticks(6))
                .call(g => g.select('.domain').attr('stroke', '#e5e5e5'))
                .call(g => g.selectAll('.tick line').attr('stroke', '#e5e5e5'))
                .call(g => g.selectAll('.tick text').attr('fill', '#666').attr('font-size', '0.7rem'));

            svg.append('g')
                .attr('transform', `translate(${margin.left},0)`)
                .call(d3.axisLeft(yScale).ticks(6))
                .call(g => g.select('.domain').attr('stroke', '#e5e5e5'))
                .call(g => g.selectAll('.tick line').attr('stroke', '#e5e5e5'))
                .call(g => g.selectAll('.tick text').attr('fill', '#666').attr('font-size', '0.7rem'));

            // Axis labels
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height - 8)
                .attr('text-anchor', 'middle')
                .attr('fill', '#666')
                .attr('font-size', '0.75rem')
                .attr('font-weight', '500')
                .text('← Less buying | Backward Linkage | More buying →');

            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', 14)
                .attr('text-anchor', 'middle')
                .attr('fill', '#666')
                .attr('font-size', '0.75rem')
                .attr('font-weight', '500')
                .text('← Less selling | Forward Linkage | More selling →');

            // Dots
            const tooltip = document.getElementById('tooltip');

            const dots = svg.selectAll('circle')
                .data(linkagesData)
                .enter()
                .append('circle')
                .attr('cx', d => xScale(d.bl))
                .attr('cy', d => yScale(d.fl))
                .attr('r', d => sizeScale(d.output))
                .attr('fill', d => getColor(d))
                .attr('fill-opacity', 0.7)
                .attr('stroke', d => getColor(d))
                .attr('stroke-width', 1)
                .style('cursor', 'pointer')
                .on('mouseover', function(event, d) {
                    if (!selectedChartIndustry) {
                        d3.select(this).attr('fill-opacity', 1).attr('stroke-width', 2);
                    }
                    showTooltip(event, d);
                })
                .on('mousemove', function(event) {
                    tooltip.style.left = (event.clientX + 12) + 'px';
                    tooltip.style.top = (event.clientY + 12) + 'px';
                })
                .on('mouseout', function(event, d) {
                    if (!selectedChartIndustry || selectedChartIndustry.id !== d.id) {
                        d3.select(this).attr('fill-opacity', selectedChartIndustry ? 0.1 : 0.7).attr('stroke-width', 1);
                    }
                    tooltip.classList.remove('visible');
                })
                .on('click', function(event, d) {
                    selectIndustryOnChart(d);
                });

            chartElements = { svg, dots, xScale, yScale, sizeScale };
        }

        function showTooltip(event, d) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `
                <div class="tooltip-title">${d.name}</div>
                <div class="tooltip-row"><span class="tooltip-label">Sector</span><span class="tooltip-value">${d.sector}</span></div>
                <div class="tooltip-row"><span class="tooltip-label">Output</span><span class="tooltip-value">$${d.output.toFixed(1)}B</span></div>
                <div class="tooltip-row"><span class="tooltip-label">Backward linkage</span><span class="tooltip-value" style="color:#2563eb">${d.bl.toFixed(3)}</span></div>
                <div class="tooltip-row"><span class="tooltip-label">Forward linkage</span><span class="tooltip-value" style="color:#ea580c">${d.fl.toFixed(3)}</span></div>
                ${d.isKey ? '<div style="margin-top:8px;color:#16a34a;font-weight:600">★ Key Sector</div>' : ''}
            `;
            tooltip.classList.add('visible');
        }

        function selectIndustryOnChart(d) {
            selectedChartIndustry = d;
            document.getElementById('clear-selection').classList.add('visible');
            
            chartElements.dots
                .attr('fill-opacity', node => node.id === d.id ? 1 : 0.1)
                .attr('stroke-width', node => node.id === d.id ? 3 : 1)
                .attr('stroke', node => node.id === d.id ? '#1a1a1a' : getColor(node));

            // Highlight in list
            document.querySelectorAll('.industry-item').forEach(item => {
                item.classList.toggle('selected', item.dataset.id === d.id);
            });
        }

        function clearSelection() {
            selectedChartIndustry = null;
            document.getElementById('clear-selection').classList.remove('visible');
            
            chartElements.dots
                .attr('fill-opacity', 0.7)
                .attr('stroke-width', 1)
                .attr('stroke', d => getColor(d));

            document.querySelectorAll('.industry-item').forEach(item => {
                item.classList.remove('selected');
            });
        }

        function renderIndustryList(filter = '') {
            const list = document.getElementById('industry-list');
            const filtered = linkagesData
                .filter(d => d.name.toLowerCase().includes(filter.toLowerCase()))
                .sort((a, b) => b.output - a.output)
                .slice(0, 40);

            list.innerHTML = filtered.map(d => {
                let cls = '';
                if (d.isKey) cls = 'key-sector';
                else if (d.fl > 1) cls = 'forward-oriented';
                else if (d.bl > 1) cls = 'backward-oriented';
                
                const isSelected = selectedChartIndustry && selectedChartIndustry.id === d.id;
                
                return `
                    <div class="industry-item ${cls} ${isSelected ? 'selected' : ''}" data-id="${d.id}">
                        <div class="industry-name">${d.name}</div>
                        <div class="industry-metrics">
                            <span>BL ${d.bl.toFixed(2)}</span>
                            <span>FL ${d.fl.toFixed(2)}</span>
                            <span>$${d.output.toFixed(0)}B</span>
                        </div>
                    </div>
                `;
            }).join('');

            list.querySelectorAll('.industry-item').forEach(item => {
                item.addEventListener('click', () => {
                    const d = linkagesData.find(x => x.id === item.dataset.id);
                    if (d) selectIndustryOnChart(d);
                });
            });
        }

        // =============== SHOCK ANALYSIS PAGE ===============
        function initShockPage() {
            populateShockList('list-demand', 'search-demand', (d) => {
                selectedDemandIndustry = d;
                document.getElementById('run-demand').disabled = false;
            });
            populateShockList('list-cost', 'search-cost', (d) => {
                selectedCostIndustry = d;
                document.getElementById('run-cost').disabled = false;
            });

            document.querySelectorAll('.shock-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.shock-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.shock-panel').forEach(p => p.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`panel-${tab.dataset.tab}`).classList.add('active');
                });
            });

            document.getElementById('demand-slider').addEventListener('input', (e) => {
                const val = parseFloat(e.target.value);
                document.getElementById('demand-value').textContent = (val >= 0 ? '+' : '') + `$${val}B`;
            });

            document.getElementById('cost-slider').addEventListener('input', (e) => {
                document.getElementById('cost-value').textContent = `+${e.target.value}%`;
            });

            document.getElementById('risk-threshold').addEventListener('input', (e) => {
                const labels = ['All', 'Medium+', 'High only'];
                document.getElementById('risk-threshold-value').textContent = labels[e.target.value - 1];
            });

            document.getElementById('run-demand').addEventListener('click', runDemandShock);
            document.getElementById('run-cost').addEventListener('click', runCostShock);
            document.getElementById('run-risk').addEventListener('click', runRiskAnalysis);
            document.getElementById('clear-demand').addEventListener('click', clearShockResults);
            document.getElementById('clear-cost').addEventListener('click', clearShockResults);
        }

        function populateShockList(listId, searchId, onSelect) {
            const list = document.getElementById(listId);
            const search = document.getElementById(searchId);
            
            function render(filter = '') {
                const filtered = shockData
                    .filter(d => d.name.toLowerCase().includes(filter.toLowerCase()))
                    .sort((a, b) => b.output - a.output)
                    .slice(0, 30);
                
                list.innerHTML = filtered.map(d => `
                    <div class="shock-industry-item" data-id="${d.id}">
                        <div class="shock-industry-name">${d.name}</div>
                        <div class="shock-industry-meta">${d.sector} · $${d.output.toFixed(1)}B · ${d.outputMultiplier.toFixed(2)}x</div>
                    </div>
                `).join('');
                
                list.querySelectorAll('.shock-industry-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const d = shockData.find(x => x.id === item.dataset.id);
                        onSelect(d);
                        list.querySelectorAll('.shock-industry-item').forEach(i => i.classList.remove('selected'));
                        item.classList.add('selected');
                    });
                });
            }
            
            render();
            search.addEventListener('input', (e) => render(e.target.value));
        }

        function clearShockResults() {
            document.getElementById('results-container').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-text">No analysis running</div>
                    <div class="empty-state-hint">Choose settings in the left panel and click a button to start</div>
                </div>
            `;
            document.getElementById('results-title').textContent = 'Results';
            document.getElementById('results-subtitle').textContent = 'Select an industry and run analysis';
        }

        function runDemandShock() {
            if (!selectedDemandIndustry) return;
            
            const shock = parseFloat(document.getElementById('demand-slider').value);
            const d = selectedDemandIndustry;
            
            const impacts = [];
            const L_col = L_sparse[d.id] || {};
            const totalOutputImpact = shock * d.outputMultiplier;
            
            Object.entries(L_col).forEach(([targetId, multiplier]) => {
                const target = shockData.find(x => x.id === targetId);
                if (target && targetId !== d.id) {
                    impacts.push({
                        id: targetId,
                        name: target.name,
                        sector: target.sector,
                        impact: shock * multiplier,
                        pctOfOutput: (shock * multiplier / target.output) * 100
                    });
                }
            });
            
            impacts.sort((a, b) => Math.abs(b.impact) - Math.abs(a.impact));
            
            document.getElementById('results-title').textContent = `Demand Shock: ${d.name}`;
            document.getElementById('results-subtitle').textContent = `${shock >= 0 ? '+' : ''}$${shock}B change in final demand`;
            
            const maxImpact = Math.max(...impacts.map(x => Math.abs(x.impact)), 0.01);
            
            document.getElementById('results-container').innerHTML = `
                <div class="metrics-row">
                    <div class="metric-card">
                        <div class="metric-label">Direct change</div>
                        <div class="metric-value ${shock >= 0 ? 'positive' : 'negative'}">${shock >= 0 ? '+' : ''}$${shock}B</div>
                        <div class="metric-detail">Applied to ${d.name.substring(0, 25)}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Total economy impact</div>
                        <div class="metric-value ${shock >= 0 ? 'positive' : 'negative'}">${shock >= 0 ? '+' : ''}$${totalOutputImpact.toFixed(1)}B</div>
                        <div class="metric-detail">Multiplier: ${d.outputMultiplier.toFixed(2)}x</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Industries affected</div>
                        <div class="metric-value">${impacts.length}</div>
                        <div class="metric-detail">Through supply chain</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Backward linkage</div>
                        <div class="metric-value">${d.bl?.toFixed(2) || '—'}</div>
                        <div class="metric-detail">${(d.bl || 0) > 1 ? 'Above' : 'Below'} average</div>
                    </div>
                </div>

                <div class="results-card">
                    <div class="results-card-title">Supplier industries affected</div>
                    <div class="results-card-subtitle">Industries that supply inputs — their output changes when demand for ${d.name.substring(0, 30)} changes</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 40%">Industry</th>
                                <th style="width: 15%">Sector</th>
                                <th style="width: 15%">Impact</th>
                                <th style="width: 12%">% of output</th>
                                <th style="width: 18%">Scale</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${impacts.slice(0, 20).map(imp => `
                                <tr>
                                    <td><strong>${imp.name.substring(0, 40)}</strong></td>
                                    <td style="color: #666; font-size: 0.7rem;">${imp.sector}</td>
                                    <td style="font-family: 'IBM Plex Mono'; font-size: 0.75rem; color: ${imp.impact >= 0 ? '#16a34a' : '#dc2626'}">
                                        ${imp.impact >= 0 ? '+' : ''}$${imp.impact.toFixed(2)}B
                                    </td>
                                    <td style="font-family: 'IBM Plex Mono'; font-size: 0.75rem; color: #666;">
                                        ${Math.abs(imp.pctOfOutput).toFixed(2)}%
                                    </td>
                                    <td>
                                        <div class="bar-cell">
                                            <div class="bar-fill blue" style="width: ${(Math.abs(imp.impact) / maxImpact * 100)}%"></div>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function runCostShock() {
            if (!selectedCostIndustry) return;
            
            const costIncrease = parseFloat(document.getElementById('cost-slider').value) / 100;
            const d = selectedCostIndustry;
            
            const costImpacts = [];
            const A_row = A_sparse[d.id] || {};
            
            Object.entries(A_row).forEach(([customerId, inputShare]) => {
                const customer = shockData.find(x => x.id === customerId);
                if (customer) {
                    costImpacts.push({
                        id: customerId,
                        name: customer.name,
                        sector: customer.sector,
                        inputShare: inputShare * 100,
                        costPush: inputShare * costIncrease * 100,
                        output: customer.output
                    });
                }
            });
            
            costImpacts.sort((a, b) => b.costPush - a.costPush);
            const totalExposure = costImpacts.reduce((sum, x) => sum + x.costPush * x.output / 100, 0);
            
            document.getElementById('results-title').textContent = `Cost Shock: ${d.name}`;
            document.getElementById('results-subtitle').textContent = `+${(costIncrease * 100).toFixed(0)}% price increase`;
            
            const maxCost = Math.max(...costImpacts.map(x => x.costPush), 0.01);
            
            document.getElementById('results-container').innerHTML = `
                <div class="metrics-row">
                    <div class="metric-card">
                        <div class="metric-label">Price increase</div>
                        <div class="metric-value negative">+${(costIncrease * 100).toFixed(0)}%</div>
                        <div class="metric-detail">In ${d.name.substring(0, 25)}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Downstream industries</div>
                        <div class="metric-value">${costImpacts.length}</div>
                        <div class="metric-detail">Directly exposed</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Total cost exposure</div>
                        <div class="metric-value negative">$${totalExposure.toFixed(1)}B</div>
                        <div class="metric-detail">Potential margin impact</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Forward linkage</div>
                        <div class="metric-value">${d.fl?.toFixed(2) || '—'}</div>
                        <div class="metric-detail">${(d.fl || 0) > 1 ? 'Major supplier' : 'Limited reach'}</div>
                    </div>
                </div>

                <div class="results-card">
                    <div class="results-card-title">Downstream cost exposure</div>
                    <div class="results-card-subtitle">Industries that buy from ${d.name.substring(0, 35)} — shows how their costs increase</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 40%">Customer industry</th>
                                <th style="width: 15%">Sector</th>
                                <th style="width: 15%">Input share</th>
                                <th style="width: 12%">Cost push</th>
                                <th style="width: 18%">Exposure</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${costImpacts.slice(0, 25).map(imp => `
                                <tr>
                                    <td><strong>${imp.name.substring(0, 40)}</strong></td>
                                    <td style="color: #666; font-size: 0.7rem;">${imp.sector}</td>
                                    <td style="font-family: 'IBM Plex Mono'; font-size: 0.75rem;">${imp.inputShare.toFixed(1)}%</td>
                                    <td style="font-family: 'IBM Plex Mono'; font-size: 0.75rem; color: #dc2626;">+${imp.costPush.toFixed(2)}%</td>
                                    <td>
                                        <div class="bar-cell">
                                            <div class="bar-fill red" style="width: ${(imp.costPush / maxCost * 100)}%"></div>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function runRiskAnalysis() {
            const threshold = parseInt(document.getElementById('risk-threshold').value);
            
            const riskScores = shockData.map(d => {
                const concentrationRisk = (d.inputConcentration || 0) / 100;
                const dependencyRisk = (d.totalInputShare || 0) / 100;
                const pricingPowerRisk = (d.fl || 1) < 1 ? (1 - (d.fl || 1)) : 0;
                
                const riskScore = (concentrationRisk * 0.4 + dependencyRisk * 0.4 + pricingPowerRisk * 0.2) * 100;
                
                let riskLevel = 'low';
                if (riskScore > 30) riskLevel = 'medium';
                if (riskScore > 50) riskLevel = 'high';
                
                return { ...d, riskScore, riskLevel, concentrationRisk: concentrationRisk * 100, dependencyRisk: dependencyRisk * 100 };
            });
            
            const levels = threshold === 3 ? ['high'] : threshold === 2 ? ['high', 'medium'] : ['high', 'medium', 'low'];
            const filtered = riskScores.filter(d => levels.includes(d.riskLevel));
            filtered.sort((a, b) => b.riskScore - a.riskScore);
            
            const highRisk = riskScores.filter(d => d.riskLevel === 'high').length;
            const medRisk = riskScores.filter(d => d.riskLevel === 'medium').length;
            const lowRisk = riskScores.filter(d => d.riskLevel === 'low').length;
            
            document.getElementById('results-title').textContent = 'Supply Chain Risk';
            document.getElementById('results-subtitle').textContent = `${filtered.length} industries shown`;
            
            document.getElementById('results-container').innerHTML = `
                <div class="metrics-row">
                    <div class="metric-card">
                        <div class="metric-label">High risk</div>
                        <div class="metric-value negative">${highRisk}</div>
                        <div class="metric-detail">Concentrated, dependent</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Medium risk</div>
                        <div class="metric-value" style="color:#ea580c">${medRisk}</div>
                        <div class="metric-detail">Moderate exposure</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Low risk</div>
                        <div class="metric-value positive">${lowRisk}</div>
                        <div class="metric-detail">Diversified inputs</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Avg risk score</div>
                        <div class="metric-value">${(riskScores.reduce((s, x) => s + x.riskScore, 0) / riskScores.length).toFixed(1)}</div>
                        <div class="metric-detail">Economy-wide</div>
                    </div>
                </div>

                <div class="results-card">
                    <div class="results-card-title">Margin risk assessment</div>
                    <div class="results-card-subtitle">Risk = Input concentration (40%) + Input dependency (40%) + Limited pricing power (20%)</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 32%">Industry</th>
                                <th style="width: 10%">Risk</th>
                                <th style="width: 10%">Score</th>
                                <th style="width: 12%">Concentration</th>
                                <th style="width: 12%">Dependency</th>
                                <th style="width: 8%">FL</th>
                                <th style="width: 16%">Scale</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filtered.slice(0, 30).map(d => `
                                <tr>
                                    <td><strong>${d.name.substring(0, 30)}</strong></td>
                                    <td><span class="risk-badge ${d.riskLevel}">${d.riskLevel}</span></td>
                                    <td style="font-family: 'IBM Plex Mono'; font-size: 0.75rem;">${d.riskScore.toFixed(1)}</td>
                                    <td style="font-family: 'IBM Plex Mono'; font-size: 0.75rem; color: #666;">${d.concentrationRisk.toFixed(1)}%</td>
                                    <td style="font-family: 'IBM Plex Mono'; font-size: 0.75rem; color: #666;">${d.dependencyRisk.toFixed(1)}%</td>
                                    <td style="font-family: 'IBM Plex Mono'; font-size: 0.75rem; color: ${(d.fl || 0) > 1 ? '#16a34a' : '#666'};">${d.fl?.toFixed(2) || '—'}</td>
                                    <td>
                                        <div class="bar-cell">
                                            <div class="bar-fill orange" style="width: ${d.riskScore}%"></div>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
    </script>
</body>
</html>
